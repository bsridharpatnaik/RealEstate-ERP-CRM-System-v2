-- Supplier
CREATE OR REPLACE VIEW supplier as 
SELECT 
c.contact_id,c.name,c.mobile_no,c.email_id,c.contact_type,ci.contact_person,
ci.contact_person_mobile_no,ci.gst_number,
a.addr_line1,a.addr_line2,a.city,a.state,a.zip
FROM contact c
LEFT JOIN  contact_info ci on c.contact_id=ci.contact_id
INNER JOIN address a on a.addr_id = c.addr_id
WHERE 
c.contact_type='SUPPLIER'
AND ci.is_deleted=0;


-- Contrator
CREATE OR REPLACE VIEW contractor as 
SELECT 
c.contact_id,c.name,c.mobile_no,c.email_id,c.contact_type,ci.contact_person,
ci.contact_person_mobile_no,ci.gst_number,
a.addr_line1,a.addr_line2,a.city,a.state,a.zip
FROM contact c
LEFT JOIN  contact_info ci on c.contact_id=ci.contact_id
INNER JOIN address a on a.addr_id = c.addr_id
WHERE 
c.contact_type='CONTRACTOR'
AND ci.is_deleted=0;

-- All contacts
CREATE OR REPLACE VIEW AllContacts as 
SELECT 
c.contact_id,c.name,c.mobile_no,c.email_id,c.contact_type,ci.contact_person,
ci.contact_person_mobile_no,ci.gst_number,
a.addr_line1,a.addr_line2,a.city,a.state,a.zip
FROM contact c
LEFT JOIN  contact_info ci on c.contact_id=ci.contact_id
INNER JOIN address a on a.addr_id = c.addr_id
WHERE ci.is_deleted=0 OR ci.is_deleted IS NULL;


CREATE 
or REPLACE view all_inventory as 
select
   tx.*,
   c.name,
   c.mobile_no,
   c.email_id,
   c.contact_type,
   w.warehouse_id,
   w.warehouse_name 
from
   (
      SELECT
         'inward' as type,
         ii.in_inventory_id as id,
         DATE_FORMAT(ii.date, " % Y -% m -% d") as date,
         ii.contact_id as contactid,
         ii.warehouse_id as warehouseid,
         ioe.product_id as productid,
         ioe.quantity,
         ioe.closing_stock 
      FROM
         inward_inventory ii 
         INNER JOIN
            inwardinventory_entry iie 
            on ii.in_inventory_id = iie.in_inventory_id 
         INNER JOIN
            inward_outward_entries ioe 
            on iie.entry_id = ioe.entryid 
      WHERE
         ii.is_deleted = 0 
      UNION ALL
      select
         'outward' as type,
         oi.ou_inventory_id,
         DATE_FORMAT(oi.date, " % Y -% m -% d") as date,
         oi.contact_id as contactid,
         oi.warehouse_id as warehouseid,
         ioe.product_id as productid,
         ioe.quantity,
         ioe.closing_stock 
      from
         outward_inventory oi 
         INNER JOIN
            outwardinventory_entry oie 
            on oi.ou_inventory_id = oie.ou_inventory_id 
         INNER JOIN
            inward_outward_entries ioe 
            on oie.entry_id = ioe.entryid 
      where
         oi.is_deleted = 0 
      UNION ALL
      SELECT
         'lost/damaged' as type,
         id,
         DATE_FORMAT(ldi.date, " % Y -% m -% d") as date,
         '' as contactid,
         ldi.warehouse_name as warehouseid,
         ldi.product_id as productid,
         ldi.quantity,
         ldi.closing_stock 
      FROM
         lost_damaged_inventory ldi 
   )
   as tx 
   LEFT JOIN
      AllContacts c 
      on c.contact_id = tx.contactid 
   INNER JOIN
      warehouse w 
      on w.warehouse_id = tx.warehouseid 
order by
   id desc;
			  
